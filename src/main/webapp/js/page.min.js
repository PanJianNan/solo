var Page=function(a){this.currentCommentId="";this.tips=a};$.extend(Page.prototype,{insertEmotions:function(a){var b=this;if(a===undefined){a=""}$("#emotions"+a+" span").click(function(){var g=$("#comment"+a);var e=b._getCursorEndPosition(g[0]);var d=this.title+" ",c=g[0].value;c=c.substring(0,e)+d+c.substring(e,c.length);$("#comment"+a).val(c);if($.browser.msie){e-=c.split("\n").length-1;var f=g[0].createTextRange();f.collapse(true);f.moveStart("character",e+d.length);f.select()}else{g[0].setSelectionRange(e+d.length,e+d.length)}})},_getCursorEndPosition:function(a){a.focus();if(a.setSelectionRange){return a.selectionEnd}else{if(document.selection){var b=0,c=document.selection.createRange(),d=document.body.createTextRange();d.moveToElementText(a);c.getBookmark();for(b=0;d.compareEndPoints("StartToStart",c)<0&&c.moveStart("character",-1)!==0;b++){if(a.value.charAt(b)==="\n"){b++}}return b}}},validateComment:function(c){if(Util.isLoggedIn()){var b=$("#comment"+c).val().replace(/(^\s*)|(\s*$)/g,"");if(2>b.length||b.length>500){$("#commentErrorTip"+c).html(this.tips.commentContentCannotEmptyLabel);$("#comment"+c).focus()}else{return true}$("#commentErrorTip"+c).show();return false}var a=$("#commentName"+c).val().replace(/(^\s*)|(\s*$)/g,""),b=$("#comment"+c).val().replace(/(^\s*)|(\s*$)/g,"");if(2>b.length||b.length>500){$("#commentErrorTip"+c).html(this.tips.commentContentCannotEmptyLabel);$("#comment"+c).focus()}else{if($("#commentValidate"+c).val().replace(/\s/g,"")===""){$("#commentErrorTip"+c).html(this.tips.captchaCannotEmptyLabel);$("#commentValidate"+c).focus()}else{return true}}$("#commentErrorTip"+c).show();return false},replaceCommentsEm:function(a){var d=$(a);for(var b=0;b<d.length;b++){var c=d[b].innerHTML;d[b].innerHTML=Util.replaceEmString(c)}},_initSyntaxHighlighter:function(b){for(var a=0;a<b.length;a++){switch(b[a]){case"groovy":b[a]="groovy				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushGroovy.js";break;case"java":b[a]="java				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJava.js";break;case"php":b[a]="php				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPhp.js";break;case"scala":b[a]="scala				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushScala.js";break;case"sql":b[a]="sql				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushSql.js";break;case"applescript":b[a]="applescript			"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushAppleScript.js";break;case"as3":case"actionscript3":b[a]="actionscript3 as3                  "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushAS3.js";break;case"bash":case"shell":b[a]="bash shell                         "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushBash.js";break;case"coldfusion":case"cf":b[a]="coldfusion cf			"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushColdFusion.js";break;case"c#":case"c-sharp":case"csharp":b[a]="c# c-sharp csharp                  "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCSharp.js";break;case"cpp":case"c":b[a]="cpp c				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCpp.js";break;case"css":b[a]="css				"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushCss.js";break;case"delphi":case"pascal":b[a]="delphi pascal			"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushDelphi.js";break;case"diff":case"patch":case"pas":b[a]="diff patch pas			"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushDiff.js";break;case"erl":case"erlang":b[a]="erl erlang                         "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushErlang.js";break;case"js":case"jscript":case"javascript":b[a]="js jscript javascript              "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJScript.js";break;case"jfx":case"javafx":b[a]="jfx javafx                 	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushJavaFX.js";break;case"perl":case"pl":b[a]="perl pl                    	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPerl.js";break;case"plain":case"text":b[a]="text plain                 	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPlain.js";break;case"ps":case"powershell":b[a]="ps powershell                      "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPowerShell.js";break;case"py":case"python":b[a]="py python                          "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushPython.js";break;case"rails":case"ror":case"ruby":case"rb":b[a]="ruby rails ror rb          	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushRuby.js";break;case"sass":case"scss":b[a]="sass scss                  	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushSass.js";break;case"vb":case"vbnet":b[a]="vb vbnet                   	"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushVb.js";break;case"xml":case"xhtml":case"xslt":case"html":b[a]="xml xhtml xslt html                "+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushXml.js";break;default:break}}SyntaxHighlighter.autoloader.apply(null,b);SyntaxHighlighter.config.stripBrs=true;SyntaxHighlighter.all()},_loadSyntaxHighlighter:function(a){var c=a?a:"shCoreEclipse",b=this;if(document.createStyleSheet){document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/styles/"+c+".css")}else{$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/styles/"+c+".css' type='text/css' charset='utf-8' />"))}$.ajax({url:latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shCore.js",dataType:"script",cache:true,success:function(){var e=[],d=false;$(".article-body pre, .code-highlight pre").each(function(){var f=this.className.split(";")[0];var g=f.substr(7,f.length-1);if(this.className.indexOf("html-script: true")>-1&&(g!=="xml"&&g!=="xhtml"&&g!=="xslt"&&g!="html")){d=true}e.push(g)});if(d){$.ajax({url:latkeConfig.staticServePath+"/js/lib/SyntaxHighlighter/scripts/shBrushXml.js",dataType:"script",cache:true,success:function(){b._initSyntaxHighlighter(e)}})}else{b._initSyntaxHighlighter(e)}}})},parseLanguage:function(c){var b=false,a=false;$(".article-body pre, .code-highlight pre").each(function(){if(this.className.indexOf("brush")>-1){a=true}if(this.className.indexOf("prettyprint")>-1){b=true}});if(a){this._loadSyntaxHighlighter(c?(c.SHTheme?c.SHTheme:undefined):undefined);return false}if(b){if(document.createStyleSheet){document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.css")}else{$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.css'>"))}$.ajax({url:latkeConfig.staticServePath+"/js/lib/google-code-prettify/prettify.js",dataType:"script",cache:true,success:function(){prettyPrint()}});return false}if(document.createStyleSheet){document.createStyleSheet(latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/styles/default.css")}else{$("head").append($("<link rel='stylesheet' href='"+latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/styles/github.css'>"))}$.ajax({url:latkeConfig.staticServePath+"/js/lib/highlight.js-9.6.0/highlight.pack.js",dataType:"script",cache:true,success:function(){hljs.initHighlighting.called=false;hljs.initHighlighting()}})},load:function(c){var a=this;a.insertEmotions();a.parseLanguage(c?(c.language?c.language:undefined):undefined);$("#commentValidate").keypress(function(d){if(d.keyCode===13){a.submitComment()}});$("#comment").keypress(function(d){if(d.keyCode===13&&d.ctrlKey){a.submitComment()}});$("#captcha").click(function(){$(this).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())});if(!Util.isLoggedIn()){$("#commentEmail").val(Cookie.readCookie("commentEmail"));$("#commentURL").val(Cookie.readCookie("commentURL"));$("#commentName").val(Cookie.readCookie("commentName"))}try{JSON}catch(b){document.write('<script src="'+latkeConfig.staticServePath+'/js/lib/json2.js"><\/script>')}},loadRandomArticles:function(b){var a=this.tips.randomArticles1Label;$.ajax({url:latkeConfig.servePath+"/get-random-articles.do",type:"POST",success:function(m,d){var e=m.randomArticles;if(!e||0===e.length){$("#randomArticles").remove();return}var g="";for(var f=0;f<e.length;f++){var h=e[f];var k=h.articleTitle;var j="<li><a rel='nofollow' title='"+k+"' href='"+latkeConfig.servePath+h.articlePermalink+"'>"+k+"</a></li>";g+=j}var c=b?b:"<h4>"+a+"</h4>";var l=c+"<ul class='marginLeft12'>"+g+"</ul>";$("#randomArticles").append(l)}})},loadRelevantArticles:function(b,a){$.ajax({url:latkeConfig.servePath+"/article/id/"+b+"/relevant/articles",type:"GET",success:function(e,c){var f=e.relevantArticles;if(!f||0===f.length){$("#relevantArticles").remove();return}var h="";for(var g=0;g<f.length;g++){var j=f[g];var k=j.articleTitle;var l="<li><a rel='nofollow' title='"+k+"' href='"+latkeConfig.servePath+j.articlePermalink+"'>"+k+"</a></li>";h+=l}var d=a+"<ul class='marginLeft12'>"+h+"</ul>";$("#relevantArticles").append(d)},error:function(){$("#relevantArticles").remove()}})},loadExternalRelevantArticles:function(b,c){var a=this.tips;try{$.ajax({url:"https://rhythm.b3log.org/get-articles-by-tags.do?tags="+b+"&blogHost="+a.blogHost+"&paginationPageSize="+a.externalRelevantArticlesDisplayCount,type:"GET",cache:true,dataType:"jsonp",error:function(){$("#externalRelevantArticles").remove()},success:function(g,f){var h=g.articles;if(!h||0===h.length){$("#externalRelevantArticles").remove();return}var k="";for(var j=0;j<h.length;j++){var l=h[j];var m=l.articleTitle;var o="<li><a rel='nofollow' title='"+m+"' target='_blank' href='"+l.articlePermalink+"'>"+m+"</a></li>";k+=o}var e=c?c:"<h4>"+a.externalRelevantArticles1Label+"</h4>";var n=e+"<ul class='marginLeft12'>"+k+"</ul>";$("#externalRelevantArticles").append(n)}})}catch(d){}},submitComment:function(c,f){if(!f){f=""}var e=this,a=this.tips,d="article";if(this.validateComment(f)){$("#submitCommentButton"+f).attr("disabled","disabled");$("#commentErrorTip"+f).show().html(this.tips.loadingLabel);var b={oId:a.oId,commentContent:$("#comment"+f).val().replace(/(^\s*)|(\s*$)/g,"")};if(!Util.isLoggedIn()){b={oId:a.oId,commentContent:$("#comment"+f).val().replace(/(^\s*)|(\s*$)/g,""),commentEmail:$("#commentEmail"+f).val(),commentURL:Util.proessURL($("#commentURL"+f).val().replace(/(^\s*)|(\s*$)/g,"")),commentName:$("#commentName"+f).val().replace(/(^\s*)|(\s*$)/g,""),captcha:$("#commentValidate"+f).val()};Cookie.createCookie("commentName",b.commentName,365);Cookie.createCookie("commentEmail",b.commentEmail,365);Cookie.createCookie("commentURL",$("#commentURL"+f).val().replace(/(^\s*)|(\s*$)/g,""),365)}if(f==="Reply"){b.commentOriginalCommentId=c}$.ajax({type:"POST",url:latkeConfig.servePath+"/add-"+d+"-comment.do",cache:false,contentType:"application/json",data:JSON.stringify(b),success:function(g){$("#submitCommentButton"+f).removeAttr("disabled");if(!g.sc){$("#commentErrorTip"+f).html(g.msg);$("#commentValidate"+f).val("");$("#captcha"+f).click();if(!Util.isLoggedIn()){$("#captcha"+f).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())}return}$("#comment"+f).val(g.commentContent);$("#commentName"+f).val(g.commentName);g.replyNameHTML="";if(!Util.isLoggedIn()){$("#captcha"+f).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random());if($("#commentURL"+f).val().replace(/\s/g,"")===""){g.replyNameHTML="<a>"+$("#commentName"+f).val()+"</a>"}else{g.replyNameHTML='<a href="'+Util.proessURL($("#commentURL"+f).val())+'" target="_blank">'+$("#commentName"+f).val()+"</a>"}g.userName=g.commentName}else{g.replyNameHTML='<a href="'+window.location.host+'" target="_blank">'+Util.getUserName()+"</a>";g.userName=Util.getUserName()}e.addCommentAjax(Util.replaceEmString(g.cmtTpl),f)}})}},addReplyForm:function(e,b,d){var c=this;if(e===this.currentCommentId){if($("#commentNameReply").val()===""){$("#commentNameReply").focus()}else{if($("#commentEmailReply").val()===""){$("#commentEmailReply").focus()}else{$("#commentReply").focus()}}return}$("#replyForm").remove();d=d?d:"";if(d==="</div>"){$("#"+e).append(b+$("#commentForm").html()+d)}else{$("#"+e).append(b+$("#commentForm").html()+"</table>"+d)}$("#replyForm input, #replyForm textarea").each(function(){this.id=this.id+"Reply"});$("#commentNameReply").val(Cookie.readCookie("commentName"));$("#commentEmailReply").val(Cookie.readCookie("commentEmail"));var a=$("#replyForm #commentURLLabel");if(a.length===1){a.attr("id","commentURLLabelReply")}$("#commentURLReply").val(Cookie.readCookie("commentURL"));$("#replyForm #emotions").attr("id","emotionsReply");this.insertEmotions("Reply");$("#commentReply").unbind().keypress(function(f){if(f.keyCode===13&&f.ctrlKey){c.submitComment(e,"Reply");f.preventDefault()}});$("#commentValidateReply").unbind().keypress(function(f){if(f.keyCode===13){c.submitComment(e,"Reply");f.preventDefault()}});$("#replyForm #captcha").attr("id","captchaReply").attr("src",latkeConfig.servePath+"/captcha.do?"+new Date().getTime()).click(function(){$(this).attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())});$("#replyForm #commentErrorTip").attr("id","commentErrorTipReply").html("").hide();$("#replyForm #submitCommentButton").attr("id","submitCommentButtonReply");$("#replyForm #submitCommentButtonReply").unbind("click").removeAttr("onclick").click(function(){c.submitComment(e,"Reply")});if($("#commentNameReply").val()===""){$("#commentNameReply").focus()}else{if($("#commentEmailReply").val()===""){$("#commentEmailReply").focus()}else{$("#commentReply").focus()}}this.currentCommentId=e},hideComment:function(a){$("#commentRef"+a).hide()},showComment:function(b,f,d,e){var c=parseInt($(b).position().top);if(e){c=parseInt($(b).parents(e).position().top)}if($("#commentRef"+f).length>0){$("#commentRef"+f).show().css("top",(c+d)+"px")}else{var a=$("#"+f).clone();a.addClass("comment-body-ref").attr("id","commentRef"+f);a.find("#replyForm").remove();$("#comments").append(a);$("#commentRef"+f).css("top",(c+d)+"px")}},addCommentAjax:function(b,a){if($("#comments").children().length>0){$($("#comments").children()[0]).before(b)}else{$("#comments").html(b)}if(a===""){$("#commentErrorTip").html("").hide();$("#comment").val("");$("#commentValidate").val("");$("#captcha").attr("src",latkeConfig.servePath+"/captcha.do?code="+Math.random())}else{$("#replyForm").remove()}window.location.hash="#comments"}});